name: GlaDOS Auto Checkin

# 触发规则：定时+手动
on:
  schedule:
    - cron: '10 0 * * *'  # UTC00:10 → 北京时间8:10
  workflow_dispatch:  # 手动触发

# 强制指定读写权限
permissions:
  contents: write

jobs:
  checkin:
    runs-on: ubuntu-latest
    steps:
      - name: 拉取仓库代码
        uses: actions/checkout@v4
        # 确保拉取主分支最新代码
        with:
          ref: main

      - name: 配置Python环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          # 关键：关闭pip缓存检测，避免查找requirements.txt
          cache: ''

      - name: 安装依赖（仅requests）
        run: pip install requests --upgrade

      - name: 执行签到脚本
        run: python glados_checkin.py
        env:
          GLADOS_COOKIE: ${{ secrets.GLADOS_COOKIE }}
